



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://safetyculture.github.io/iauditor-exporter/understanding-the-data/the-model/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>The Database Model - iAuditor Exporter</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#the-database-model" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://safetyculture.github.io/iauditor-exporter/" title="iAuditor Exporter" aria-label="iAuditor Exporter" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              iAuditor Exporter
            </span>
            <span class="md-header-nav__topic">
              
                The Database Model
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/SafetyCulture/iauditor-exporter/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://safetyculture.github.io/iauditor-exporter/" title="iAuditor Exporter" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../images/logo.svg" width="48" height="48">
      
    </a>
    iAuditor Exporter
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/SafetyCulture/iauditor-exporter/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../install-intros/introduction" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install-intros/quick-install" title="Quick Install" class="md-nav__link">
      Quick Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install-intros/detailed-install" title="Detailed Installation Instructions" class="md-nav__link">
      Detailed Installation Instructions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install-intros/linux-install" title="Notes for Linux Users" class="md-nav__link">
      Notes for Linux Users
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      1. Install Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        1. Install Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Install-python/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Install-python/mac/" title="Mac" class="md-nav__link">
      Mac
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Install-python/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      2. Download the Script
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        2. Download the Script
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-download/git/" title="Using Git (Recommended)" class="md-nav__link">
      Using Git (Recommended)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-download/manual-dl/" title="Manual Download (If you can't use Git)" class="md-nav__link">
      Manual Download (If you can't use Git)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      3. Setting up the Script
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        3. Setting up the Script
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-setup/installing-packages/" title="Installing Requirements" class="md-nav__link">
      Installing Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-setup/config/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      4. Running the Script
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        4. Running the Script
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-running/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../script-running/export-options/" title="Export Options" class="md-nav__link">
      Export Options
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Understanding the Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Understanding the Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../overview" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../csv-or-sql" title="CSV or SQL?" class="md-nav__link">
      CSV or SQL?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../datastructure" title="Columns" class="md-nav__link">
      Columns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="." title="Database Model" class="md-nav__link">
      Database Model
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#primary-keys" class="md-nav__link">
    Primary Keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-merge_rowsactions_merge_rows-is-disabled" class="md-nav__link">
    If merge_rows/actions_merge_rows is disabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-merge_rowsactions_merge_rows-is-enabled" class="md-nav__link">
    If merge_rows/actions_merge_rows is enabled
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SafetyCulture/iauditor-exporter/edit/master/docs/understanding-the-data/the-model.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="the-database-model">The Database Model</h1>
<p>As part of the SQL support in this tool, if the table doesn't already exist, the script will attempt to create it for you. This document will explain the structure of the database, and how we manage Primary Keys. </p>
<p>As discussed <a href="../../understanding-the-data/datastructure/#auditid">here</a>, the <code>AuditID</code> is always unique for a particular inspection, and the <code>ItemID</code> is always unique for a particular item within an inspection. This allows us to reference a item uniquely within the dataset. However, this is making the assumption that an inspection never reappears which isn't necessarily true. The exporter tool (and the API) finds inspections based on the date they were last modified (recorded as the <code>DateModified</code> in the dataset) so if an inspection is modified after first being recorded, we'll see the same inspection reappear. </p>
<p>Due to this, the database can be configured to manage this in different ways. </p>
<h2 id="primary-keys">Primary Keys</h2>
<p>In a lot of databases, the Primary Key would be a single column however when working with iAuditor, we combine either two or three columns to obtain a unique reference. By defining what makes a column unique, we can also use it as a means to update records that already exist. </p>
<h3 id="if-merge_rowsactions_merge_rows-is-disabled">If merge_rows/actions_merge_rows is disabled</h3>
<p>When this is set to <code>false</code> in the config file, the Primary Key of the database is formed using three columns:</p>
<ul>
<li><code>AuditID</code></li>
<li><code>ItemID</code></li>
<li><code>DatePK</code></li>
</ul>
<p>We've already discussed how the <code>AuditID</code> and <code>ItemID</code> can form a unique reference, but we need to allow for the possibility of a modified inspection reappearing. This is done using the column <code>DatePK</code>. </p>
<p><code>DatePK</code> is a custom column added by the script (it isn't present in the usual API output), and is the EPOCH representation (the number of seconds since January 1st 1970) of <code>DateModified</code>. It isn't possible to use a column of type <code>DateTime</code> as part of a Primary Key, but we can use a number (a Big Integer in this case) hence the creation of <code>DatePK</code>.</p>
<p>By combining these three columns, we can guarantee that all rows are truly unique, no matter when they were modified. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When using this method, you'll need to use a SQL statement to only bring in the most recently modified value.</p>
</div>
<h3 id="if-merge_rowsactions_merge_rows-is-enabled">If merge_rows/actions_merge_rows is enabled</h3>
<p>When this is set to <code>true</code> in the config file, the Primary Key of the database is formed using two columns:</p>
<ul>
<li><code>AuditID</code></li>
<li><code>ItemID</code></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The exporting of inactive items is also forced to <code>true</code>. See the warning below for some discussion around this.</p>
</div>
<p>When enabled, we don't use <code>DatePK</code> within our Primary Key, instead relying purely on the <code>AuditID</code> and <code>ItemID</code> to look for unique columns. The script attempts to bulk upload each inspection to the database. If it isn't able to bulk upload the inspection due to a violation of the Primary Key (e.g. there's a duplicate), it goes through each row within the inspection, searches for the <code>AuditID</code>+<code>ItemID</code> row in question and <em>updates</em> the row instead.  </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This setting may seem like the more obvious choice however it has some important caveats:</p>
<ul>
<li>
<p>If you get a lot of inspections coming back through (particular prevalent if you've opted to download incomplete inspections as they may be downloaded multiple times during an inspection process), the tool will run slower as it needs to select the duplicate row and update it. The bulk upload that occurs when there is no duplicate is <em>significantly</em> faster. It also has the potential to put additional strain on your SQL server. </p>
</li>
<li>
<p>The exporting of inactive items is forced to <code>true</code> as to ensure every item in the inspection is updated should a change be made. For example, let's say you have an inspection with a logic field which displays 5 questions if you select 'Yes' and 3 questions if you select 'No'. Without enabling the export of inactive items, if the first time we see the inspection, 'Yes' has been selected, the other 3 questions wouldn't be logged at all. This isn't necessarily a problem, but if the inspection is then modified to be 'No', the 5 questions under 'Yes' wouldn't be marked as inactive in the dataset (because they'd be excluded), but the 3 questions under 'No' would still be introduced. In this scenario, the data is rendered incorrect as the questions under 'Yes' would be considered answered in our dataset when in fact they're no longer present. </p>
</li>
<li>
<p>Due to inactive items being exported, your dataset has the potential to be bigger, especially if your templates make heavy use of logic fields. For some templates this could easily double or triple the number of rows created. </p>
</li>
<li>If you need advice on this setting, please get in touch.</li>
</ul>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>